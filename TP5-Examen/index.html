<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Boussole</title>
    </head>
    <body>
    <div id="Canvas"></div>
    <div id="SVGContainer">
        <svg height="500" width="500" id="SVG"
             xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <image x="0" y="0" height="500" width="500"  xlink:href="img/compass.svg" />
            <image x="0" y="0" height="500" width="500" xlink:href="img/arrow.svg" />
        </svg>
    </div>
    <script>
        //Partie Canvas
        var divCanvas = document.getElementById("Canvas");
        var zoneCanvas = document.createElement("canvas");
        var ctx = zoneCanvas.getContext("2d");
        var imgB = document.createElement("img");
        var imgA = document.createElement("img");

        zoneCanvas.height="200";
        zoneCanvas.width="200";
        divCanvas.appendChild(zoneCanvas);
        imgB.src = 'img/compass.png'
        imgA.src = 'img/needle.png'
        imgB.onload = function () {
            ctx.drawImage(imgB, 0, 0);
            imgA.onload = function () {
                ctx.drawImage(imgA, 0, 0);

            }
        }

        //Partie SVG
        var SVG = document.getElementById("SVG");
        var divSVG = document.getElementById("SVGContainer");
        var aiguille = SVG.children[1];

        window.addEventListener('deviceorientation', function (event) {
            //Partie Canvas
            console.log("change detected");
            var angle = event.alpha;
            var rad = angle * (Math.PI / 180);
            ctx.clearRect(0, 0, zoneCanvas.width, zoneCanvas.height);
            ctx.drawImage(imgB, 0, 0);
            ctx.save();
            ctx.translate(zoneCanvas.width / 2, zoneCanvas.height / 2);
            ctx.rotate(rad);
            ctx.translate(- zoneCanvas.width / 2, - zoneCanvas.height / 2);
            ctx.drawImage(imgA, 0, 0);
            ctx.restore();

            //Partie SVG
            divSVG.removeChild(SVG);
            aiguille.setAttribute("transform", "rotate(" + angle + " 250 250)");
            SVG.children[1] = aiguille;
            divSVG.appendChild(SVG);


        });
    </script>
    </body>
</html>
